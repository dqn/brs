check:
    cargo check --workspace

test:
    cargo test --workspace

clippy:
    cargo clippy --workspace -- -D warnings

fmt:
    cargo fmt --all

fmt-check:
    cargo fmt --all -- --check

# Generate Java golden master fixtures
golden-master-gen:
    cd ../lr2oraja-java && ./gradlew golden-master:run --args="$(pwd)/../lr2oraja-rust/test-bms $(pwd)/../lr2oraja-rust/golden-master/fixtures"

# Run golden master comparison tests
golden-master-test:
    cargo test -p golden-master -- --nocapture

# Generate rule engine GM fixtures
golden-master-rule-gen:
    cd ../lr2oraja-java && ./gradlew golden-master:run -PmainClass=bms.model.golden.RuleExporter --args="$(pwd)/../lr2oraja-rust/golden-master/fixtures"

# Generate pattern shuffle GM fixtures
golden-master-pattern-gen:
    cd ../lr2oraja-java && ./gradlew golden-master:run -PmainClass=bms.model.golden.PatternExporter --args="$(pwd)/../lr2oraja-rust/golden-master/fixtures"

# Generate replay GM fixtures
golden-master-replay-gen:
    cd ../lr2oraja-java && ./gradlew golden-master:run -PmainClass=bms.model.golden.ReplayExporter --args="$(pwd)/../lr2oraja-rust/golden-master/fixtures"

# Generate database GM fixtures
golden-master-database-gen:
    cd ../lr2oraja-java && ./gradlew golden-master:run -PmainClass=bms.model.golden.DatabaseExporter --args="$(pwd)/../lr2oraja-rust/test-bms $(pwd)/../lr2oraja-rust/golden-master/fixtures"

# Generate config GM fixtures
golden-master-config-gen:
    cd ../lr2oraja-java && ./gradlew golden-master:run -PmainClass=bms.model.golden.ConfigExporter --args="$(pwd)/../lr2oraja-rust/golden-master/fixtures"

# Generate autoplay GM fixtures
golden-master-autoplay-gen:
    cd ../lr2oraja-java && ./gradlew golden-master:run -PmainClass=bms.model.golden.AutoplayExporter --args="$(pwd)/../lr2oraja-rust/test-bms $(pwd)/../lr2oraja-rust/golden-master/fixtures"

# Generate audio GM fixtures
golden-master-audio-gen:
    cd ../lr2oraja-java && ./gradlew golden-master:run -PmainClass=bms.model.golden.AudioExporter --args="$(pwd)/../lr2oraja-rust/test-bms/audio $(pwd)/../lr2oraja-rust/golden-master/fixtures/audio_fixtures.json"

# Generate JudgeManager GM fixtures
golden-master-judge-gen:
    cd ../lr2oraja-java && ./gradlew golden-master:run -PmainClass=bms.model.golden.JudgeManagerExporter --args="$(pwd)/../lr2oraja-rust/test-bms $(pwd)/../lr2oraja-rust/golden-master/fixtures"

# Update skin snapshot fixtures
golden-master-skin-snapshot:
    UPDATE_SNAPSHOTS=1 cargo test -p golden-master compare_skin -- --nocapture

# Generate all GM fixtures (parse + rule + pattern + replay + database + config + autoplay + audio + judge)
golden-master-gen-all: golden-master-gen golden-master-rule-gen golden-master-pattern-gen golden-master-replay-gen golden-master-database-gen golden-master-config-gen golden-master-autoplay-gen golden-master-audio-gen golden-master-judge-gen

# Screenshot tests (GPU required, local execution)
screenshot-test:
    cargo test -p bms-render --test screenshot_tests -- --ignored --nocapture

# Regenerate screenshot fixtures
screenshot-update:
    UPDATE_SCREENSHOTS=1 cargo test -p bms-render --test screenshot_tests -- --ignored --nocapture

all: check test clippy fmt-check
